{"id":"f5bacdbe-d829-4167-bba6-8189cda8ebad","zed":"context","version":"0.4.0","text":"\nDO NOT GIVE ME HIGH-LEVEL THEORY. IF I ASK FOR A FIX OR EXPLANATION, I WANT ACTUAL CODE OR EXPLANATION!!! I DON'T WANT \"Here's how you can blablabla\"\n\nBe casual unless otherwise specified\nBe terse and concise\nSuggest solutions that I didn’t think about—anticipate my needs\nTreat me as an expert\nBe accurate and thorough\nGive the answer immediately. Provide detailed explanations and restate my query in your own words if necessary after giving the answer\nValue good arguments over authorities, the source is irrelevant\nConsider new technologies and contrarian ideas, not just conventional wisdom\nYou may use high levels of speculation or prediction, just flag it for me\nNo moral lectures\nDiscuss safety only when it's crucial and non-obvious\nIf your content policy is an issue, provide the closest acceptable response and explain the content policy issue afterward\nCite sources whenever possible at the end, not inline\nNo need to mention your knowledge cutoff\nNo need to disclose you're an AI\nPlease respect my prettier preferences when you provide code\nSplit into multiple responses if one response isn't enough to answer the question\nFocus on readability over being performant\nFully implement all requested functionality\nLeave NO todos, placeholders, or missing pieces\n\n```ts dance-book-app/src/lib/supabase/server.ts\nimport { createServerClient } from \"@supabase/ssr\";\nimport { cookies } from \"next/headers\";\n\nexport async function createClient() {\n  const cookieStore = await cookies();\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll();\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) =>\n              cookieStore.set(name, value, options),\n            );\n          } catch {\n            // The `setAll` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing\n            // user sessions.\n          }\n        },\n      },\n    },\n  );\n}\n```\n\nhow can we add the service_role here\nTo add the `service_role` key to your Supabase client, you need to modify the `createServerClient` function to accept and use the `service_role` key. Here's how you can do it:\n\n1. Add the `NEXT_PUBLIC_SUPABASE_SERVICE_ROLE_KEY` environment variable to your `.env` file.\n2. Modify the `createClient` function to include the `service_role` key.\n\nHere's the updated code:\n\n```ts\nimport { createServerClient } from \"@supabase/ssr\";\nimport { cookies } from \"next/headers\";\n\nexport async function createClient(useServiceRole = false) {\n  const cookieStore = await cookies();\n\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\n  const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;\n  const supabaseServiceRoleKey = process.env.NEXT_PUBLIC_SUPABASE_SERVICE_ROLE_KEY!;\n\n  const supabaseKey = useServiceRole ? supabaseServiceRoleKey : supabaseAnonKey;\n\n  return createServerClient(\n    supabaseUrl,\n    supabaseKey,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll();\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) =>\n              cookieStore.set(name, value, options),\n            );\n          } catch {\n            // The `setAll` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing\n            // user sessions.\n          }\n        },\n      },\n    },\n  );\n}\n```\n\n### Explanation:\n1. **Environment Variable**: Add `NEXT_PUBLIC_SUPABASE_SERVICE_ROLE_KEY` to your `.env` file.\n2. **Function Parameter**: Added a `useServiceRole` parameter to the `createClient` function to toggle between the anon key and the service role key.\n3. **Key Selection**: Based on the `useServiceRole` parameter, the appropriate key is selected and used to create the Supabase client.\n\n### Usage:\nTo use the service role key, call `createClient(true)`. For the anon key, call `createClient()` or `createClient(false)`.\n\nThis approach ensures that you can easily switch between the anon key and the service role key as needed.\n","messages":[{"id":{"replica_id":0,"value":0},"start":0,"metadata":{"role":"user","status":"Done","timestamp":{"replica_id":0,"value":175}}},{"id":{"replica_id":0,"value":32},"start":2165,"metadata":{"role":"assistant","status":"Done","timestamp":{"replica_id":0,"value":176}}},{"id":{"replica_id":0,"value":33},"start":4245,"metadata":{"role":"user","status":"Done","timestamp":{"replica_id":0,"value":177}}}],"summary":"Add service_role to Supabase client","slash_command_output_sections":[{"range":{"start":0,"end":1276},"icon":"Library","label":"Default","metadata":null},{"range":{"start":1,"end":1275},"icon":"Library","label":"General","metadata":null},{"range":{"start":1277,"end":2127},"icon":"File","label":"dance-book-app/src/lib/supabase/server.ts","metadata":{"path":"dance-book-app/src/lib/supabase/server.ts"}}]}